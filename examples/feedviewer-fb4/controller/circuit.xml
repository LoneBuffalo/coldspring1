<!-- 

	$Id: circuit.xml,v 1.1 2005/09/24 22:12:44 rossd Exp $
	$Source: D:/CVSREPO/coldspring/coldspring/examples/feedviewer-fb4/controller/circuit.xml,v $
	$State: Exp $
	$Log: circuit.xml,v $
	Revision 1.1  2005/09/24 22:12:44  rossd
	first commit of sample app and m2 plugin
	
	Revision 1.3  2005/02/14 00:56:35  rossd
	*** empty log message ***
	
	Revision 1.2  2005/02/11 17:56:54  rossd
	eliminated rdbms vendor-specific services, replaced with generic sql services
	added datasourceSettings bean containing vendor information
	
	Revision 1.2  2005/02/10 16:40:18  rossd
	*** empty log message ***
	
	Revision 1.1  2005/02/10 13:07:22  rossd
	*** empty log message ***

    Copyright (c) 2005 David Ross

 -->


<circuit access="public">

	<fuseaction name="showHome">
		<do action="viewNav" />
		<do action="viewEntries" />
	</fuseaction>

	<fuseaction name="viewNav">
		<invoke object="appManagers.categoryManager" methodcall="getAllCategories()"
				returnVariable="request.eventargs.categories" />
				
		<do action="v.showCategories"/>
		
		<invoke object="appManagers.channelManager" methodcall="getAllChannels()"
				returnVariable="request.eventargs.channels" />
				
		<do action="v.showChannels"/>
				
	</fuseaction>

	<fuseaction name="viewEntries">
	    
		<invoke object="appManagers.entryManager" methodcall="getAllEntries( request.event )"
				returnVariable="request.eventargs.entries" />
				
		<do action="v.showEntries"/>
				
	</fuseaction>

    <!--category fuseactions -->

	<fuseaction name="showCategory">
	    <do action="viewNav" />
	    <do action="viewExistingCategory" />		
	</fuseaction>
	
	
	<fuseaction name="viewExistingCategory">
	   <invoke object="appManagers.categoryManager" methodcall="getCategoryById( request.event )"
				returnVariable="request.eventargs.category" />	
				
	   <do action="copyEventArgs"/>
	   
	   <invoke object="appManagers.channelManager" methodcall="getChannelsByCategoryId( request.event )"
				returnVariable="request.eventargs.categorychannels" />	
				
       <do action="v.renderCategory" />	
	</fuseaction>
    	
	<fuseaction name="newCategory">
	   <do action="viewNav" />
	   
	   <instantiate object="request.eventargs.category" 
	                   class="category"/>
	   		
       <do action="v.renderCategory" />	
	</fuseaction>	
	
	
	<fuseaction name="saveCategory">
	   <instantiate object="request.eventargs.category" 
	                   class="category"/>
	   <if condition="structkeyexists(attributes,'id')">
           <true>
               <invoke object="request.eventargs.category"  methodcall="setId(attributes.id)"/>
           </true>
	   </if>
	   
       <invoke object="request.eventargs.category"  methodcall="setName(attributes.name)"/>
       <invoke object="request.eventargs.category"  methodcall="setDescription(attributes.description)"/>
	   
	   <do action="copyEventArgs"/>
	   
       <invoke object="appManagers.categoryManager" methodcall="saveCategory( request.event )" returnVariable="bIsSuccess" />
       
       <if condition="bIsSuccess">
           <true>
               <do action="showHome"/>
           </true>
           <false>
              <do action="viewNav" />
              <do action="v.renderCategory" />
           </false>
	   </if>
       
	</fuseaction>	
	
	<fuseaction name="removeCategory">
        <invoke object="appManagers.categoryManager" methodcall="getCategoryById( request.event )"
            returnVariable="request.eventargs.category" />

        <do action="copyEventArgs"/>

        <invoke object="appManagers.categoryManager" methodcall="removeCategory( request.event )"
            returnVariable="bIsSuccess" />

        <if condition="bIsSuccess">
            <true>
                <do action="showHome"/>
            </true>
            <false>
                <do action="viewNav" />
                <do action="v.renderCategory" />
            </false>
        </if>
		 
	</fuseaction>
	
	
    <!--channel fuseactions -->

	<fuseaction name="showchannel">
	    <do action="viewNav" />
	    <do action="viewExistingchannel" />		
	</fuseaction>
	
	
	<fuseaction name="viewExistingchannel">
	   <invoke object="appManagers.channelManager" methodcall="getChannelById( request.event )"
				returnVariable="request.eventargs.channel" />	
	   
	   <do action="copyEventArgs"/>		
	   
	   <invoke object="appManagers.entryManager" methodcall="getEntriesByChannelId( request.event )"
				returnVariable="request.eventargs.channelentries" />	
	 
	   <do action="v.renderchannel" />	
	</fuseaction>
    	
	<fuseaction name="newchannel">
	   <do action="viewNav" />
	   
	   <instantiate object="request.eventargs.channel" 
	                   class="channel"/>
	   		
       <do action="v.renderchannel" />	
	</fuseaction>	
	
	
	<fuseaction name="savechannel">
	   <instantiate object="request.eventargs.channel" 
	                   class="channel"/>
	   <if condition="structkeyexists(attributes,'id')">
           <true>
            <invoke object="request.eventargs.channel"  methodcall="setId(attributes.id)"/>
           </true>
	   </if>
       <invoke object="request.eventargs.channel"  methodcall="setTitle(attributes.title)"/>
       <invoke object="request.eventargs.channel"  methodcall="setUrl(attributes.url)"/>
       <invoke object="request.eventargs.channel"  methodcall="setDescription(attributes.description)"/>
	   
	   <if condition="structkeyexists(attributes,'categoryIds')">
           <true>
				<invoke object="request.eventargs.channel"  methodcall="setCategoryIds(attributes.categoryIds)"/>
           </true>
	   </if>
	   
	   
	   <do action="copyEventArgs"/>
	   
       <invoke object="appManagers.channelManager" methodcall="saveChannel( request.event )" returnVariable="bIsSuccess" />
       <if condition="bIsSuccess">
           <true>
               <invoke object="appManagers.aggregatorManager" methodcall="aggregrateChannelFeed( request.event )"/>
               <do action="showHome"/>
           </true>
           <false>
              <do action="viewNav" />
              <do action="v.renderchannel" />
           </false>
	   </if>
       
	</fuseaction>	
	
	<fuseaction name="removechannel">
        <invoke object="appManagers.channelManager" methodcall="getchannelById( request.event )"
            returnVariable="request.eventargs.channel" />

        <do action="copyEventArgs"/>

        <invoke object="appManagers.channelManager" methodcall="removechannel( request.event )"
            returnVariable="bIsSuccess" />

        <if condition="bIsSuccess">
            <true>
                <do action="showHome"/>
            </true>
            <false>
                <do action="viewNav" />
                <do action="v.renderchannel" />
            </false>
        </if>
		 
	</fuseaction>
	
	
	<fuseaction name="refreshChannelEntries">
	   <do action="viewNav" />
	   
	    <invoke object="appManagers.channelManager" methodcall="getchannelById( request.event )"
            returnVariable="request.eventargs.channel" />
        
        <do action="copyEventArgs"/>

	    <invoke object="appManagers.aggregatorManager" methodcall="aggregrateChannelFeed( request.event )"/>
        
        <invoke object="appManagers.entryManager" methodcall="getEntriesByChannelId( request.event )"
				returnVariable="request.eventargs.channelentries" />	
	 
        <do action="v.renderchannel" />	
	</fuseaction>
	
	
	
	
	
	<fuseaction name="copyEventArgs">
        <!-- calling this fuseaction will force request.eventargs into the request.event cfc 
             because of the preFuseaction plugin defined, we don't actually have to DO anything here
        -->
	</fuseaction>

	<fuseaction name="killEventArgs">
	    <instantiate object="request.event" 
	                   class="event"/>	    
	</fuseaction>

</circuit>

